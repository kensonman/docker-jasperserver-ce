version: "2"
services:
   dbm:
      image: postgres:9
      container_name: "${DOMAIN}.dbm"
      environment:
         - POSTGRES_USER=${DBUSER}
         - POSTGRES_PASSWORD=${DBPASS}
         - POSTGRES_DB=${DBNAME}
      volumes:
         - ./pgdata:/var/lib/postgresql/data
      ports:
         - 5432
   app:
      build: .
      container_name: "${DOMAIN}.app"
      environment:
         - DBHOST=${DBHOST}
         - DBPORT=${DBPORT}
         - DBNAME=${DBNAME}
         - DBUSER=${DBUSER}
         - DBPASS=${DBPASS}
      ports:
         - 8080:8080
         - 8443:8443
      links:
         - dbm:${DBHOST}
      depends_on:
         - dbm
